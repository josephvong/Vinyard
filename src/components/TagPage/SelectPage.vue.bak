<template>
  <div class="select-page">
    <Banner></Banner>
    <!-- <Taglist catalogName="district" :isExpress=true
             v-bind:selectedId="selectedObj.district"
             v-bind:eventHub = "eventHub"
    ></Taglist>
   <Taglist catalogName="winetype" :isExpress=true
            v-bind:selectedId="selectedObj.winetype"
            v-bind:eventHub = "eventHub"
    ></Taglist> -->
   <!--  <Taglist catalogName="grapetype" :isExpress=true
             v-bind:selectedId="selectedObj.grapetype"
             v-bind:eventHub = "eventHub"
    ></Taglist> -->

    <!-- <a href="http://www.baidu.com" v-on:click="Test()">test</a> -->
    <HomeBtn :isInResult=false ></HomeBtn>
    <CamaraBtn inPageType="selectPage" v-bind:eventHub = "eventHub" ></CamaraBtn>
    <div class="footer-wrap" style="display:block;">
      <div class="footer clearfix">
          <a class="btn" v-on:click="submitClickHandle('../ResultPage/index.html')">提交</a>
          <a class="btn" v-on:click="resetClickHandle()">重置</a>
      </div>
    </div>
  </div>
</template>

<script>
import Banner from "components/Banner/Banner.vue"
import Taglist from 'components/Taglist/Taglist.vue'
import HomeBtn from 'components/FloatBtn/HomeBtn.vue'
import CamaraBtn from 'components/FloatBtn/CamaraBtn.vue'
import Vue from "vue"
export default {
  name: 'selectpage',
  data(){
    return {
      selectedObj:{
        district:null,
        winetype:null,
        grapetype:null
      },
      eventHub:new Vue() // 父子节点之间的事件集合器
    }
  },
  computed:{

  },
  methods:{
    modifySelection(obj){
      if(this.selectedObj[obj.catalogName]==obj.tId){
        this.selectedObj[obj.catalogName] = null
      }else{
        this.selectedObj[obj.catalogName] = obj.tId
      }
    },
    resetClickHandle(){  // 重置选项
      this.selectedObj={
        district:null,
        winetype:null,
        grapetype:null
      }
    },
    submitClickHandle(url){  // 重置选项
      this.storeStatusJump(url);
    },

    storeStatusJump(url){
      event.preventDefault();
      let path = this.$route.path
      window.history.pushState({"path":path},"","");  // 设置浏览器历史
      window.localStorage.setItem('selectedObj',JSON.stringify(this.selectedObj) ) // 设置本地缓存
      window.location.href=url;
    }
  },
  components:{
    Banner,Taglist,HomeBtn,CamaraBtn
  },
  mounted(){
    window.localStorage.removeItem('resultList');
    window.localStorage.removeItem('pageIndex');
    window.localStorage.removeItem('scrollTop');

    // 加载页面组件时：
    window.history.replaceState("","",""); // 清空历史记录
    if(window.localStorage.getItem('selectedObj')){  // 如果有本地缓存
      let newObj=null;
      newObj=Object.assign({},JSON.parse(window.localStorage.getItem('selectedObj'))); // 根据本地缓存还原选项
      this.selectedObj = newObj;
      window.localStorage.removeItem('selectedObj')  // 删除本地缓存
    }
    // 监听 标签列表 子节点 的点击事件触发
    this.eventHub.$on("modifySelection",(obj)=>{
      this.modifySelection(obj)
    })
     // 监听 浮动按钮（拍照搜酒） 的点击事件触发
     this.eventHub.$on("goCamaraPage",(url)=>{
      this.storeStatusJump(url)
    })
  }
}
</script>

<style scpoed rel="stylesheet/css">
.select-page{
  width:100%;
  padding:8rem 0;
}

.footer-wrap{
  position: fixed;
  bottom:0;left:0;
  width: 100%;
  height:4rem;

}
.footer-wrap .footer{
  position: relative;
  width: 100%; max-width:640px;
  height:4rem;
  margin: 0 auto;
  background: white;

}
.footer-wrap .footer:after{
  content: "";
  position:absolute;
  width:100%; height: 1px;
  top:-1px; left:0;
  transform:scaleY(0.5);
  -webkit-transform:scaleY(0.5);
  background: #E0E0E0;
}
.footer-wrap .footer .btn{
  position: relative;
  display: inline-block;
  float: left;
  width:50%; height:4rem; line-height: 4rem;
  text-align:center;

}
.footer-wrap .footer .btn:nth-of-type(2):after{
  content: "";
  position: absolute;
  left: 0; top:0;
  height: 100%; width: 1px;
  transform:scaleX(0.5);
  -webkit-transform:scaleX(0.5);
  background: #E0E0E0;
}

</style>